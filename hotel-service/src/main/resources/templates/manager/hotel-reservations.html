<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .hotel-background {
            background-image: url('/background/manager-hotel-board.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
        }

        .container-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 30px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0;
        }

        .table-custom {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .reservation-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-completed {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-upcoming {
            background: #cce7ff;
            color: #004085;
        }

        .btn-gold {
            background: linear-gradient(45deg, #d4af37, #f4d03f);
            border: none;
            color: #2c3e50;
            font-weight: 600;
            border-radius: 25px;
            padding: 8px 20px;
        }

        .pagination-custom .page-link {
            color: #667eea;
            border: 1px solid #dee2e6;
        }

        .pagination-custom .page-item.active .page-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .navbar-nav .nav-link {
            color: white;
        }
    </style>
</head>
<body>
<div th:insert="~{/parts/manager_navbar_macro :: dark_navbar}"></div>

<div class="hotel-background">
    <div class="container">
        <div class="container-glass">
            <div class="row align-items-center mb-4">
                <div class="col text-start">
                    <h1 class="text-dark mb-0" th:text="'üìã –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ' + ${hotelName}">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è</h1>
                </div>
                <div class="col-auto text-end">
                    <a th:href="@{/managing-hotel}" class="btn btn-outline-secondary">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
                    </a>
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">üìÖ –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ</h5>
                    <form method="post" th:action="@{/managing-hotel/reservations}">
                        <div class="row align-items-end">
                            <div class="col-md-5">
                                <label class="form-label">–î–∞—Ç–∞:</label>
                                <input type="date" name="date" class="form-control" th:value="${date}">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">–ü–æ–∫–∞–∑–∞—Ç—å:</label>
                                <select name="isCheckOut" class="form-select">
                                    <option value="false" th:selected="${isCheckOut == false}">–ó–∞–µ–∑–¥—ã</option>
                                    <option value="true" th:selected="${isCheckOut == true}">–í—ã–µ–∑–¥—ã</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn btn-gold w-100 mt-3">
                                    üìÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">üéØ –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –Ω–æ–º–µ—Ä–∞</h5>
                    <form method="post" th:action="@{/managing-hotel/reservations}">
                        <div class="row align-items-end">
                            <div class="col-md-8">
                                <select name="filter" class="form-select">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã –Ω–æ–º–µ—Ä–æ–≤</option>
                                    <option th:each="roomTypeItem : ${roomType}"
                                            th:value="${roomTypeItem.id}"
                                            th:text="${roomTypeItem.name}"
                                            th:selected="${filter == roomTypeItem.id}">
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn btn-gold w-100 mt-3">
                                    üéØ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                                </button>
                            </div>
                        </div>
                    </form>
                    <div class="mt-2">
                        <a th:href="@{/managing-hotel/reservations}" class="btn btn-outline-secondary btn-sm">
                            üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
                        </a>
                    </div>
                </div>
            </div>
            <div th:if="${not #lists.isEmpty(reservations)}">
                <div class="table-responsive">
                    <table class="table table-custom table-hover">
                        <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>–ì–æ—Å—Ç—å</th>
                            <th>–¢–∏–ø –Ω–æ–º–µ—Ä–∞</th>
                            <th>–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã</th>
                            <th>–ó–∞–µ–∑–¥</th>
                            <th>–í—ã–µ–∑–¥</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="reservation : ${reservations}">
                            <td th:text="${reservation.id}" class="fw-bold"></td>
                            <td>
                                <strong th:text="${reservation.firstName + ' ' + reservation.lastName}"></strong>
                                <br>
                                <small class="text-muted" th:text="${reservation.user.username}"></small>
                            </td>
                            <td>
                                <span class="badge bg-primary" th:text="${reservation.roomTypeName}"></span>
                            </td>
                            <td th:text="${reservation.room.number}" class="fw-bold text-center"></td>
                            <td th:text="${#temporals.format(reservation.checkIn, 'dd.MM.yyyy')}"></td>
                            <td th:text="${#temporals.format(reservation.checkOut, 'dd.MM.yyyy')}"></td>
                            <td th:text="'+' + ${reservation.phNumber}"></td>
                            <td>
              <span th:if="${reservation.checkOut.isBefore(T(java.time.LocalDate).now())}"
                    class="reservation-status status-completed">
                –ó–∞–≤–µ—Ä—à–µ–Ω–æ
              </span>
                                <span th:if="${reservation.checkIn.isAfter(T(java.time.LocalDate).now())}"
                                      class="reservation-status status-upcoming">
                –ü—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ
              </span>
                                <span th:if="${reservation.checkIn.isBefore(T(java.time.LocalDate).now()) and reservation.checkOut.isAfter(T(java.time.LocalDate).now())}"
                                      class="reservation-status status-active">
                –ê–∫—Ç–∏–≤–Ω–æ
              </span>
                            </td>
                            <td>
                                <form th:action="@{'/managing-hotel/reservations/' + ${reservation.id} + '/reservation-delete'}"
                                      method="post"
                                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                                    </button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div th:if="${page}" class="d-flex justify-content-center mt-4">
                    <nav>
                        <ul class="pagination pagination-custom">
                            <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/managing-hotel/reservations(page=0, size=${page.size}, hotelName=${hotelName})}">–ü–µ—Ä–≤–∞—è</a>
                            </li>
                            <li class="page-item" th:classappend="${page.hasPrevious()} ? '' : 'disabled'">
                                <a class="page-link"
                                   th:href="@{/managing-hotel/reservations(page=${page.number - 1}, size=${page.size}, hotelName=${hotelName})}">–ù–∞–∑–∞–¥</a>
                            </li>

                            <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                                class="page-item"
                                th:classappend="${i == page.number} ? 'active' : ''">
                                <a class="page-link"
                                   th:href="@{/managing-hotel/reservations(page=${i}, size=${page.size}, hotelName=${hotelName})}"
                                   th:text="${i + 1}"></a>
                            </li>

                            <li class="page-item" th:classappend="${page.hasNext()} ? '' : 'disabled'">
                                <a class="page-link"
                                   th:href="@{/managing-hotel/reservations(page=${page.number + 1}, size=${page.size}, hotelName=${hotelName})}">–í–ø–µ—Ä–µ–¥</a>
                            </li>
                            <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/managing-hotel/reservations(page=${page.totalPages - 1}, size=${page.size}, hotelName=${hotelName})}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(reservations)}" class="text-center py-5">
                <div class="text-muted">
                    <h3>üì≠ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –≤–∞—à–µ–º –æ—Ç–µ–ª–µ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞</p>
                    <a th:href="@{/managing-hotel}" class="btn btn-gold mt-3">
                        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <div th:insert="~{parts/footer_macro :: footer}"></div>
    </div>
</div>
</body>
</html>